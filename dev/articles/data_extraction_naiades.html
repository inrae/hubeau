<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting data from the API "qualité des cours d'eau" • hubeau</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting data from the API " qualit des cours d>
<meta property="og:description" content="hubeau">
<meta property="og:image" content="https://inrae.github.io/hubeau/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hubeau</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.4.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data_extraction_naiades.html">Getting data from the API "qualité des cours d'eau"</a>
    </li>
    <li>
      <a href="../articles/example_ecoulement_api.html">Performing queries on the 'Ecoulement' API</a>
    </li>
    <li>
      <a href="../articles/example_niveaux_nappes_api.html">Performing queries on the 'niveaux_nappes' API</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/inrae/hubeau" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting data from the API “qualité des cours
d’eau”</h1>
                        <h4 data-toc-skip class="author">Philippe
Amiotte Suchet, David Dorchies</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/inrae/hubeau/blob/master/vignettes/data_extraction_naiades.Rmd" class="external-link"><code>vignettes/data_extraction_naiades.Rmd</code></a></small>
      <div class="hidden name"><code>data_extraction_naiades.Rmd</code></div>

    </div>

    
    
<p>This vignette describes how to use functions of the <a href="https://cran.r-project.org/package=hubeau" class="external-link">R package
<em>hubeau</em></a> to query the French Naiades database through the <a href="https://hubeau.eaufrance.fr/page/api-qualite-cours-deau" class="external-link">API
“qualité des cours d’eau”</a>.</p>
<p>The <a href="https://naiades.eaufrance.fr/" class="external-link">Naiades database</a>
gathers hydrobiology, hydrogeomophomogy and physico-chemical information
for French river and lake water. The information is associated with a
water quality station (location), a date (the day of the sampling or of
the observation) and a material (water, suspended matter, sediment,
river bed, fish, etc.). <strong>The API “qualité des cours d’eau”
focuses only on water physico-chemical properties.</strong></p>
<p>This example shows how to get physico-chemical information (here
nitrates concentration) from the Naiades database on water monitoring
sites belonging to an administrative entity (here the Cote d’Or
department).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inrae.github.io/hubeau/">hubeau</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/Hmisc/" class="external-link">Hmisc</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="get-started">Get started<a class="anchor" aria-label="anchor" href="#get-started"></a>
</h2>
<div class="section level3">
<h3 id="how-it-works">How it works<a class="anchor" aria-label="anchor" href="#how-it-works"></a>
</h3>
<p>The <em>hubeau</em> package provides functions to query the databases
of the French water information system using the Hub’eau API.</p>
<p>The functions are named as follows:
<code>hubeau::get_[API]_[endpoint](argument)</code> where:</p>
<ul>
<li><p>[API] is the name of the API (one API = one database)</p></li>
<li><p>[endpoint] is the type of information which is queried in the
database; the query is defined by a list of arguments.</p></li>
</ul>
<p>For example the function <code><a href="../reference/get_qualite_rivieres.html">get_qualite_rivieres_station()</a></code>
uses the API “qualité des cours d’eau” to get the water quality stations
corresponding to requirements described in the <code>station()</code>
function.</p>
<p>See the <a href="https://github.com/inrae/hubeau#api-hydrom%C3%A9trie" class="external-link">readme in
the R package <em>hubeau</em></a>.</p>
</div>
<div class="section level3">
<h3 id="listing-the-apis-searchable-with-the-hubeau-r-package">Listing the APIs searchable with the <em>hubeau</em> R package<a class="anchor" aria-label="anchor" href="#listing-the-apis-searchable-with-the-hubeau-r-package"></a>
</h3>
<p>The <em>hubeau</em> R package allows to query 11 databases which can
be listed as follow:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lists.html">list_apis</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "prelevements"         "indicateurs_services" "hydrometrie"         </span></span>
<span><span class="co">#&gt;  [4] "niveaux_nappes"       "poisson"              "ecoulement"          </span></span>
<span><span class="co">#&gt;  [7] "hydrobio"             "temperature"          "qualite_eau_potable" </span></span>
<span><span class="co">#&gt; [10] "qualite_nappes"       "qualite_rivieres"</span></span></code></pre></div>
<p>The name of the API which will be used below is
<code>"qualite_rivieres"</code> using the <a href="https://hubeau.eaufrance.fr/page/api-qualite-cours-deau" class="external-link">“qualité
des cours d’eau” Hub’eau API</a> allowing to query the <a href="https://naiades.eaufrance.fr/bienvenue-naiades" class="external-link">Naiades
database</a>.</p>
</div>
<div class="section level3">
<h3 id="available-endpoints-for-the-qualite_rivieres-api">Available endpoints for the “qualite_rivieres” API<a class="anchor" aria-label="anchor" href="#available-endpoints-for-the-qualite_rivieres-api"></a>
</h3>
<p>The function
<code>list_endpoints(api = "name of the api given by &lt;list_apis&gt;")</code>
of the <em>hubeau</em> R package lists the available endpoints. For the
<code>qualite_rivieres</code> API it gives:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lists.html">list_endpoints</a></span><span class="op">(</span>api <span class="op">=</span> <span class="st">"qualite_rivieres"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "analyse_pc"                    "condition_environnementale_pc"</span></span>
<span><span class="co">#&gt; [3] "operation_pc"                  "station_pc"</span></span></code></pre></div>
<p>These 4 endpoints are described in the <a href="https://hubeau.eaufrance.fr/page/api-qualite-cours-deau" class="external-link">Hub’eau
web page of the API (see “opération” section)</a>.</p>
<ul>
<li><p>[<strong>station_pc</strong>] lists the water stations with
physico-chemical analysis;</p></li>
<li><p>[<strong>operation_pc</strong>] lists the sampling operation
occuring on each water station;</p></li>
<li><p>[<strong>condition_environnementale_pc</strong>] lists the
environmental conditions observed during water sampling (air
temperature, presence of mosses, alguae, etc.);</p></li>
<li><p>[<strong>analyse_pc</strong>] gives the results of the
physico-chemical analysis made on water samples of a selected water
station.</p></li>
</ul>
<p>Each endpoint is defined by a list of arguments to query the
database.</p>
</div>
<div class="section level3">
<h3 id="list-of-arguments-by-endpoint">List of arguments by endpoint<a class="anchor" aria-label="anchor" href="#list-of-arguments-by-endpoint"></a>
</h3>
<p>The function
<code>list_params(api = "name of the api", endpoint = "name of the endpoint")</code>
gives the arguments which can be used in the query. These arguments
correspond to the parameters of the Hub’eau API and are described in the
<a href="https://hubeau.eaufrance.fr/page/api-qualite-cours-deau" class="external-link">Hub’eau
web page of the API</a>.</p>
<p>For example, the following instruction lists the available arguments
for the endpoint “condition_environnementale_pc”:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lists.html">list_params</a></span><span class="op">(</span>api <span class="op">=</span> <span class="st">"qualite_rivieres"</span>, endpoint <span class="op">=</span> <span class="st">"condition_environnementale_pc"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "bbox"                   "code_banque_reference"  "code_commune"          </span></span>
<span><span class="co">#&gt;  [4] "code_cours_eau"         "code_departement"       "code_eu_masse_eau"     </span></span>
<span><span class="co">#&gt;  [7] "code_groupe_parametres" "code_masse_eau"         "code_parametre"        </span></span>
<span><span class="co">#&gt; [10] "code_prelevement"       "code_qualification"     "code_region"           </span></span>
<span><span class="co">#&gt; [13] "code_station"           "code_statut"            "date_debut_maj"        </span></span>
<span><span class="co">#&gt; [16] "date_debut_prelevement" "date_fin_maj"           "date_fin_prelevement"  </span></span>
<span><span class="co">#&gt; [19] "distance"               "distance"               "fields"                </span></span>
<span><span class="co">#&gt; [22] "format"                 "latitude"               "latitude"              </span></span>
<span><span class="co">#&gt; [25] "libelle_commune"        "libelle_departement"    "libelle_masse_eau"     </span></span>
<span><span class="co">#&gt; [28] "libelle_parametre"      "libelle_qualification"  "libelle_region"        </span></span>
<span><span class="co">#&gt; [31] "libelle_station"        "longitude"              "longitude"             </span></span>
<span><span class="co">#&gt; [34] "mnemo_statut"           "nom_cours_eau"          "nom_groupe_parametres" </span></span>
<span><span class="co">#&gt; [37] "page"                   "size"                   "sort"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="extracting-physico-chemical-data">Extracting physico-chemical data<a class="anchor" aria-label="anchor" href="#extracting-physico-chemical-data"></a>
</h2>
<p>This example shows how to extract the nitrates concentration values
in river water samples for stations located in the Cote d’Or department
from 2000 to 2022.</p>
<div class="section level3">
<h3 id="availability-of-stations-in-the-côte-dor-department">Availability of stations in the Côte d’Or department<a class="anchor" aria-label="anchor" href="#availability-of-stations-in-the-c%C3%B4te-dor-department"></a>
</h3>
<p>The function <code>get_qualite_rivieres_station(…)</code> will be
used to list the available stations. Arguments for the function can be
listed as follow:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lists.html">list_params</a></span><span class="op">(</span>api <span class="op">=</span> <span class="st">"qualite_rivieres"</span>, endpoint <span class="op">=</span> <span class="st">"station_pc"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "bbox"                   "code_banque_reference"  "code_bassin_dce"       </span></span>
<span><span class="co">#&gt;  [4] "code_commune"           "code_cours_eau"         "code_departement"      </span></span>
<span><span class="co">#&gt;  [7] "code_eu_masse_eau"      "code_fraction"          "code_groupe_parametres"</span></span>
<span><span class="co">#&gt; [10] "code_masse_eau"         "code_parametre"         "code_qualification"    </span></span>
<span><span class="co">#&gt; [13] "code_region"            "code_reseau"            "code_sous_bassin"      </span></span>
<span><span class="co">#&gt; [16] "code_station"           "code_statut"            "code_support"          </span></span>
<span><span class="co">#&gt; [19] "date_debut_maj"         "date_debut_prelevement" "date_fin_maj"          </span></span>
<span><span class="co">#&gt; [22] "date_fin_prelevement"   "distance"               "distance"              </span></span>
<span><span class="co">#&gt; [25] "exact_count"            "fields"                 "format"                </span></span>
<span><span class="co">#&gt; [28] "latitude"               "latitude"               "libelle_commune"       </span></span>
<span><span class="co">#&gt; [31] "libelle_departement"    "libelle_fraction"       "libelle_masse_eau"     </span></span>
<span><span class="co">#&gt; [34] "libelle_parametre"      "libelle_qualification"  "libelle_region"        </span></span>
<span><span class="co">#&gt; [37] "libelle_reseau"         "libelle_station"        "libelle_support"       </span></span>
<span><span class="co">#&gt; [40] "longitude"              "longitude"              "mnemo_statut"          </span></span>
<span><span class="co">#&gt; [43] "nom_bassin_dce"         "nom_cours_eau"          "nom_groupe_parametres" </span></span>
<span><span class="co">#&gt; [46] "nom_sous_bassin"        "page"                   "size"                  </span></span>
<span><span class="co">#&gt; [49] "sort"                   "type_entite_hydro"</span></span></code></pre></div>
<p>The argument “code_departement” will be used with the value “21”
which is the French administrative code for Côte d’Or.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">station_21</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_qualite_rivieres.html">get_qualite_rivieres_station</a></span><span class="op">(</span>code_departement <span class="op">=</span> <span class="st">"21"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">station_21</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 468 × 48</span></span></span>
<span><span class="co">#&gt;    code_station libelle_station     uri_station durete coordonnee_x coordonnee_y</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 03000029     LE RUISSEAU DU FEU… https://id… <span style="color: #BB0000;">NA</span>          <span style="text-decoration: underline;">829</span>934      6<span style="text-decoration: underline;">715</span>298 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 03000033     La Seine à Courceau https://id… <span style="color: #BB0000;">NA</span>          <span style="text-decoration: underline;">827</span>760      6<span style="text-decoration: underline;">716</span>247 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 03000070     Ruisseau de Jugny   https://id… <span style="color: #BB0000;">NA</span>          <span style="text-decoration: underline;">829</span>586      6<span style="text-decoration: underline;">718</span>953 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 03000100     LA SEINE A BAIGNEU… https://id… <span style="color: #BB0000;">NA</span>          <span style="text-decoration: underline;">826</span>286      6<span style="text-decoration: underline;">724</span>377 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 03000180     LE RU DE COSNE A Q… https://id… <span style="color: #BB0000;">NA</span>          <span style="text-decoration: underline;">824</span>754      6<span style="text-decoration: underline;">731</span>499 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 03000311     La coquille à Etal… https://id… <span style="color: #BB0000;">NA</span>          <span style="text-decoration: underline;">831</span>785      6<span style="text-decoration: underline;">728</span>503 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 03000344     LA COQUILLE A AIGN… https://id… <span style="color: #BB0000;">NA</span>          <span style="text-decoration: underline;">830</span>428      6<span style="text-decoration: underline;">730</span>843 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 03000346     La coquille à l'av… https://id… <span style="color: #BB0000;">NA</span>          <span style="text-decoration: underline;">829</span>398      6<span style="text-decoration: underline;">731</span>552 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 03000440     LE REVINSON A DUES… https://id… <span style="color: #BB0000;">NA</span>          <span style="text-decoration: underline;">827</span>650.     6<span style="text-decoration: underline;">730</span>547.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 03000450     LE REVINSON A QUEM… https://id… <span style="color: #BB0000;">NA</span>          <span style="text-decoration: underline;">825</span>751      6<span style="text-decoration: underline;">731</span>858 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 458 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 42 more variables: code_projection &lt;chr&gt;, libelle_projection &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   longitude &lt;dbl&gt;, latitude &lt;dbl&gt;, code_commune &lt;chr&gt;, libelle_commune &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   code_departement &lt;chr&gt;, libelle_departement &lt;chr&gt;, code_region &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   libelle_region &lt;chr&gt;, code_cours_eau &lt;chr&gt;, nom_cours_eau &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   uri_cours_eau &lt;chr&gt;, code_masse_deau &lt;chr&gt;, code_eu_masse_deau &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   nom_masse_deau &lt;chr&gt;, uri_masse_deau &lt;chr&gt;, code_eu_sous_bassin &lt;chr&gt;, …</span></span></span></code></pre></div>
<p>The result of the query gives a tibble of 466 rows and 48 columns
which means that the database comprises 466 water stations in the Côte
d’Or department being described by 48 parameters.</p>
</div>
<div class="section level3">
<h3 id="retrieving-nitrate-concentration-in-river-water-of-the-côte-dor-department">Retrieving nitrate concentration in river water of the Côte d’or
department<a class="anchor" aria-label="anchor" href="#retrieving-nitrate-concentration-in-river-water-of-the-c%C3%B4te-dor-department"></a>
</h3>
<p>The function <code>get_qualite_rivieres_analyse(…)</code> is used to
get the physico-chemical analysis for selected stations. Arguments for
the function can be listed as follow:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lists.html">list_params</a></span><span class="op">(</span>api <span class="op">=</span> <span class="st">"qualite_rivieres"</span>, endpoint <span class="op">=</span> <span class="st">"analyse_pc"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "bbox"                   "code_banque_reference"  "code_bassin_dce"       </span></span>
<span><span class="co">#&gt;  [4] "code_commune"           "code_cours_eau"         "code_departement"      </span></span>
<span><span class="co">#&gt;  [7] "code_eu_masse_eau"      "code_fraction"          "code_groupe_parametres"</span></span>
<span><span class="co">#&gt; [10] "code_masse_eau"         "code_parametre"         "code_prelevement"      </span></span>
<span><span class="co">#&gt; [13] "code_qualification"     "code_region"            "code_reseau"           </span></span>
<span><span class="co">#&gt; [16] "code_sous_bassin"       "code_station"           "code_statut"           </span></span>
<span><span class="co">#&gt; [19] "code_support"           "date_debut_maj"         "date_debut_prelevement"</span></span>
<span><span class="co">#&gt; [22] "date_fin_maj"           "date_fin_prelevement"   "distance"              </span></span>
<span><span class="co">#&gt; [25] "distance"               "fields"                 "format"                </span></span>
<span><span class="co">#&gt; [28] "latitude"               "latitude"               "libelle_commune"       </span></span>
<span><span class="co">#&gt; [31] "libelle_departement"    "libelle_fraction"       "libelle_masse_eau"     </span></span>
<span><span class="co">#&gt; [34] "libelle_parametre"      "libelle_qualification"  "libelle_region"        </span></span>
<span><span class="co">#&gt; [37] "libelle_reseau"         "libelle_station"        "libelle_support"       </span></span>
<span><span class="co">#&gt; [40] "longitude"              "longitude"              "mnemo_statut"          </span></span>
<span><span class="co">#&gt; [43] "nom_bassin_dce"         "nom_cours_eau"          "nom_groupe_parametres" </span></span>
<span><span class="co">#&gt; [46] "nom_sous_bassin"        "page"                   "size"                  </span></span>
<span><span class="co">#&gt; [49] "sort"                   "type_entite_hydro"</span></span></code></pre></div>
<p>These arguments are described in the <a href="https://hubeau.eaufrance.fr/page/api-qualite-cours-deau#/physicochimie/analyse_pc" class="external-link">Hub’eau
API web page</a>.</p>
<p>The arguments in this example are:</p>
<ul>
<li>
<code>code_departement</code>: French administrative code for
department (“21” for Côte d’Or)</li>
<li>
<code>code_param</code>: Code of the physico-chemical parameter; if
more than one parameter, codes must be separated by a commas; the
maximum number of codes is 200. The code of a given parameter that can
be found in the <a href="https://www.sandre.eaufrance.fr/Rechercher-une-donnee-d-un-jeu" class="external-link">French
water reference system “Sandre”</a>. For nitrates the code is
“1340”</li>
<li>
<code>date_debut_prelevement</code> et
<code>date_fin_prelevement</code>: beginning and end dates of samples
(“<em>yyyy-mm-dd</em>” format).</li>
</ul>
<p>The query can be written as follows:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nitrates_21_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_qualite_rivieres.html">get_qualite_rivieres_analyse</a></span><span class="op">(</span>code_departement <span class="op">=</span> <span class="st">"21"</span>, </span>
<span>                                            date_debut_prelevement <span class="op">=</span> <span class="st">"2000-01-01"</span>, </span>
<span>                                            date_fin_prelevement <span class="op">=</span> <span class="st">"2000-12-31"</span>, </span>
<span>                                            code_parametre <span class="op">=</span> <span class="st">"1340"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">nitrates_21_raw</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 221 125</span></span>
<span><span class="va">nitrates_21_raw</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 221 × 125</span></span></span>
<span><span class="co">#&gt;    code_station libelle_station         uri_station code_support libelle_support</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 06011000     <span style="color: #949494;">"</span>SAONE A AUXONNE 1<span style="color: #949494;">"</span>     https://id… 3            Eau            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 06017050     <span style="color: #949494;">"</span>SAONE A CHARREY-SUR-S… https://id… 3            Eau            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 03002100     <span style="color: #949494;">"</span>LA SEINE A CHARREY-SU… https://id… 0            Support inconnu</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 06016500     <span style="color: #949494;">"</span>OUCHE A ECHENON <span style="color: #949494;">"</span>      https://id… 3            Eau            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 06016000     <span style="color: #949494;">"</span>OUCHE A CRIMOLOIS 1<span style="color: #949494;">"</span>   https://id… 3            Eau            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 06013800     <span style="color: #949494;">"</span>TILLE A CHAMPDOTRE 1<span style="color: #949494;">"</span>  https://id… 3            Eau            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 03041000     <span style="color: #949494;">"</span>LA BRENNE A SAINT-REM… https://id… 3            Eau            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 06017050     <span style="color: #949494;">"</span>SAONE A CHARREY-SUR-S… https://id… 3            Eau            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 06013800     <span style="color: #949494;">"</span>TILLE A CHAMPDOTRE 1<span style="color: #949494;">"</span>  https://id… 3            Eau            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 06016000     <span style="color: #949494;">"</span>OUCHE A CRIMOLOIS 1<span style="color: #949494;">"</span>   https://id… 3            Eau            </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 211 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 120 more variables: uri_support &lt;chr&gt;, code_fraction &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   libelle_fraction &lt;chr&gt;, uri_fraction &lt;chr&gt;, date_prelevement &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   heure_prelevement &lt;chr&gt;, date_analyse &lt;chr&gt;, heure_analyse &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   code_parametre &lt;chr&gt;, libelle_parametre &lt;chr&gt;, uri_parametre &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   resultat &lt;dbl&gt;, code_groupe_parametre1 &lt;chr&gt;, code_groupe_parametre2 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   code_groupe_parametre3 &lt;chr&gt;, code_groupe_parametre4 &lt;chr&gt;, …</span></span></span></code></pre></div>
<p>The query returns a tibble of more than 13000 lines and 134 columns.
Each line corresponds to a nitrate concentration value
(<code>resultat</code>) in mg.L<sup>-1</sup> for a given station
(<code>code_station</code>) and for a given date
(<code>date_prelevement</code>).</p>
<p>The argument <code>fields</code> of the function
<code><a href="../reference/get_qualite_rivieres.html">get_qualite_rivieres_analyse()</a></code> allows to specify which
parameter (i.e. column) must be returned in the resulting tibble which
is usefull for limiting the size of the tibble.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nitrates_21</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_qualite_rivieres.html">get_qualite_rivieres_analyse</a></span><span class="op">(</span></span>
<span>  code_departement <span class="op">=</span> <span class="st">"21"</span>, </span>
<span>  date_debut_prelevement <span class="op">=</span> <span class="st">"2000-01-01"</span>, </span>
<span>  date_fin_prelevement <span class="op">=</span> <span class="st">"2022-12-31"</span>, </span>
<span>  code_parametre <span class="op">=</span> <span class="st">"1340"</span>, </span>
<span>  fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"code_station"</span>,</span>
<span>    <span class="st">"libelle_station"</span>,</span>
<span>    <span class="st">"libelle_fraction"</span>,</span>
<span>    <span class="st">"date_prelevement"</span>,</span>
<span>    <span class="st">"resultat"</span>,</span>
<span>    <span class="st">"symbole_unite"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">nitrates_21</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 13314     6</span></span>
<span><span class="va">nitrates_21</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 13,314 × 6</span></span></span>
<span><span class="co">#&gt;    code_station libelle_station       libelle_fraction date_prelevement resultat</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 06011000     <span style="color: #949494;">"</span>SAONE A AUXONNE 1<span style="color: #949494;">"</span>   Phase aqueuse d… 2000-01-11           13  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 06017050     <span style="color: #949494;">"</span>SAONE A CHARREY-SUR… Phase aqueuse d… 2000-01-11           14.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 03002100     <span style="color: #949494;">"</span>LA SEINE A CHARREY-… Phase aqueuse d… 2000-01-18           31  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 06016500     <span style="color: #949494;">"</span>OUCHE A ECHENON <span style="color: #949494;">"</span>    Phase aqueuse d… 2000-01-18           20  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 06016000     <span style="color: #949494;">"</span>OUCHE A CRIMOLOIS 1<span style="color: #949494;">"</span> Phase aqueuse d… 2000-01-18           17  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 06013800     <span style="color: #949494;">"</span>TILLE A CHAMPDOTRE … Phase aqueuse d… 2000-01-18           25.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 03041000     <span style="color: #949494;">"</span>LA BRENNE A SAINT-R… Phase aqueuse d… 2000-01-18           22.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 06017050     <span style="color: #949494;">"</span>SAONE A CHARREY-SUR… Phase aqueuse d… 2000-02-15           11.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 06013800     <span style="color: #949494;">"</span>TILLE A CHAMPDOTRE … Phase aqueuse d… 2000-02-15           20.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 06016000     <span style="color: #949494;">"</span>OUCHE A CRIMOLOIS 1<span style="color: #949494;">"</span> Phase aqueuse d… 2000-02-15           15.2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 13,304 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: symbole_unite &lt;chr&gt;</span></span></span></code></pre></div>
<p>The query still gives a tibble of more than 13000 lines but with 6
columns only.</p>
</div>
</div>
<div class="section level2">
<h2 id="extraction-and-analysis-of-data-station-by-station">Extraction and analysis of data station by station<a class="anchor" aria-label="anchor" href="#extraction-and-analysis-of-data-station-by-station"></a>
</h2>
<div class="section level3">
<h3 id="objectives">Objectives<a class="anchor" aria-label="anchor" href="#objectives"></a>
</h3>
<p>In the tibble created in the previous example, a lot of stations are
not suitable for computing basic statistical parameters (annual or
interannual mean, median, standard deviation, etc.) because they provide
only few results each year and are not representative of the seasonal
cycle of nitrates. This means that the tibble resulting from the query
may include a lot of unexploitable data and could be much smaller.</p>
<p>The data can be computed directly from the database station by
station by including the query in a loop using a known list of stations.
For each station, the number of results (available nitrates data) is
calculated each year and compared to a threshold to determine if a
statistical/graphical analysis can be computed or not.</p>
</div>
<div class="section level3">
<h3 id="selection-of-stations-available-for-analysis">Selection of stations available for analysis<a class="anchor" aria-label="anchor" href="#selection-of-stations-available-for-analysis"></a>
</h3>
<p>In the following example, a list of the stations of the Côte d’Or
department is created.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#list of station to query </span></span>
<span><span class="va">station_21</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_qualite_rivieres.html">get_qualite_rivieres_station</a></span><span class="op">(</span>code_departement <span class="op">=</span> <span class="st">"21"</span><span class="op">)</span></span></code></pre></div>
<p>Total number of stations is:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">station_21</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 468</span></span></code></pre></div>
<p>We use the function <code><a href="../reference/get_qualite_rivieres.html">get_qualite_rivieres_analyse()</a></code> to
retrieve nitrate concentration values
(<code>code_parametre = "1340"</code>) from 2000 to 2022.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nitrates_21</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_qualite_rivieres.html">get_qualite_rivieres_analyse</a></span><span class="op">(</span></span>
<span>  code_departement <span class="op">=</span> <span class="st">"21"</span>, </span>
<span>  date_debut_prelevement <span class="op">=</span> <span class="st">"2000-01-01"</span>, </span>
<span>  date_fin_prelevement <span class="op">=</span> <span class="st">"2022-12-31"</span>, </span>
<span>  code_parametre <span class="op">=</span> <span class="st">"1340"</span>, </span>
<span>  fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"code_station"</span>,</span>
<span>    <span class="st">"libelle_station"</span>,</span>
<span>    <span class="st">"libelle_fraction"</span>,</span>
<span>    <span class="st">"date_prelevement"</span>,</span>
<span>    <span class="st">"resultat"</span>,</span>
<span>    <span class="st">"symbole_unite"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We compute some annual statistics for each station:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nitrates_21</span> <span class="op">&lt;-</span> <span class="va">nitrates_21</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date_prelevement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">date_prelevement</span><span class="op">)</span>,</span>
<span>         year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date_prelevement</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">station_stats</span> <span class="op">&lt;-</span> <span class="va">nitrates_21</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">code_station</span>, <span class="va">libelle_station</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>nb_analyses <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>            nitrate_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">resultat</span><span class="op">)</span>,</span>
<span>            nitrate_p90 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">resultat</span>, probs <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span>, </span>
<span>            .groups <span class="op">=</span> <span class="st">'drop'</span><span class="op">)</span></span>
<span><span class="va">station_stats</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,830 × 6</span></span></span>
<span><span class="co">#&gt;    code_station libelle_station        year nb_analyses nitrate_mean nitrate_p90</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 03000029     LE RUISSEAU DU FEU A…  <span style="text-decoration: underline;">2</span>017           6         23.4        37.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 03000029     LE RUISSEAU DU FEU A…  <span style="text-decoration: underline;">2</span>021           6         28.3        36.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 03000029     LE RUISSEAU DU FEU A…  <span style="text-decoration: underline;">2</span>022          12         24.5        36.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 03000033     La Seine à Courceau    <span style="text-decoration: underline;">2</span>016           6         21.3        29.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 03000033     La Seine à Courceau    <span style="text-decoration: underline;">2</span>017           6         18.2        30.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 03000033     La Seine à Courceau    <span style="text-decoration: underline;">2</span>021           6         25.8        31.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 03000033     La Seine à Courceau    <span style="text-decoration: underline;">2</span>022          18         20          25  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 03000070     Ruisseau de Jugny      <span style="text-decoration: underline;">2</span>016           6         15.7        20.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 03000070     Ruisseau de Jugny      <span style="text-decoration: underline;">2</span>017           5         20.9        35.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 03000070     Ruisseau de Jugny      <span style="text-decoration: underline;">2</span>021           6         17.8        25.5</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,820 more rows</span></span></span></code></pre></div>
<p>The number of lines of the tibble <code>station_stats</code>
corresponds to the number of stations with at least one sample.</p>
<p>Stations with less than 10 values per year on average and less than
10 years of data are excluded of the statistical analysis.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">valid_stations</span> <span class="op">&lt;-</span> <span class="va">station_stats</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">code_station</span>, <span class="va">libelle_station</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>analyses_per_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">nb_analyses</span><span class="op">)</span>, nb_years <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">analyses_per_year</span> <span class="op">&gt;=</span> <span class="fl">10</span>, <span class="va">nb_years</span> <span class="op">&gt;=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">valid_stations</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 13 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   code_station [13]</span></span></span>
<span><span class="co">#&gt;    code_station libelle_station                       analyses_per_year nb_years</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 03001000     <span style="color: #949494;">"</span>LA SEINE A NOD-SUR-SEINE 1<span style="color: #949494;">"</span>                       15.4       22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 03002100     <span style="color: #949494;">"</span>LA SEINE A CHARREY-SUR-SEINE 1<span style="color: #949494;">"</span>                   11.4       22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 03006268     <span style="color: #949494;">"</span>L'OURCE A MENESBLE 1<span style="color: #949494;">"</span>                             15.8       16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 03006271     <span style="color: #949494;">"</span>LA GROÈME A TERREFONDREE 1<span style="color: #949494;">"</span>                       12.8       18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 03006590     <span style="color: #949494;">"</span>L'OURCE A AUTRICOURT 1<span style="color: #949494;">"</span>                           13.9       22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 03034720     <span style="color: #949494;">"</span>LE SEREIN A VIEUX-CHATEAU 2<span style="color: #949494;">"</span>                      14.9       18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 03036510     <span style="color: #949494;">"</span>L'ARMANÇON A MONTIGNY-SUR-ARMANCON …              15.9       16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 03040250     <span style="color: #949494;">"</span>L'OZE A DARCEY 1<span style="color: #949494;">"</span>                                 11.2       17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 06011000     <span style="color: #949494;">"</span>SAONE A AUXONNE 1<span style="color: #949494;">"</span>                                13.2       22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 06014250     <span style="color: #949494;">"</span>CENT FONDS A SAULON-LA-RUE 1<span style="color: #949494;">"</span>                     10.9       10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 06016500     <span style="color: #949494;">"</span>OUCHE A ECHENON <span style="color: #949494;">"</span>                                 11.2       22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 06017050     <span style="color: #949494;">"</span>SAONE A CHARREY-SUR-SAONE <span style="color: #949494;">"</span>                       12.9       22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> 06017070     <span style="color: #949494;">"</span>SAONE A SEURRE <span style="color: #949494;">"</span>                                  12.8       16</span></span></code></pre></div>
<p>The number of rows of the tibble <code>valid_stations</code>
corresponds to the number of stations with at least 10 samples per year
on average and 10 years of data.</p>
</div>
<div class="section level3">
<h3 id="statistical-analysis-of-samples">Statistical analysis of samples<a class="anchor" aria-label="anchor" href="#statistical-analysis-of-samples"></a>
</h3>
<p>Then, we plot the annual distribution of nitrate levels with violin
plots.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_nitrates</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">code</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">station_details</span> <span class="op">&lt;-</span> <span class="va">station_21</span><span class="op">[</span><span class="va">station_21</span><span class="op">$</span><span class="va">code_station</span> <span class="op">==</span> <span class="va">code</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="va">mean_samples</span> <span class="op">&lt;-</span> <span class="va">valid_stations</span><span class="op">$</span><span class="va">analyses_per_year</span><span class="op">[</span><span class="va">valid_stations</span><span class="op">$</span><span class="va">code_station</span> <span class="op">==</span> <span class="va">code</span><span class="op">]</span></span>
<span>  <span class="va">nitrates_station</span> <span class="op">&lt;-</span> <span class="va">nitrates_21</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">code_station</span> <span class="op">==</span> <span class="va">code</span><span class="op">)</span></span>
<span>  <span class="va">station_yearly_stats</span> <span class="op">&lt;-</span> <span class="va">station_stats</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">code_station</span> <span class="op">==</span> <span class="va">code</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">p</span>  <span class="op">&lt;-</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">nitrates_station</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">resultat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"nitrates (mg/l)"</span>,</span>
<span>      title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>        <span class="st">"station:"</span>,</span>
<span>        <span class="va">station_details</span><span class="op">$</span><span class="va">code_station</span>,</span>
<span>        <span class="va">station_details</span><span class="op">$</span><span class="va">libelle_station</span></span>
<span>      <span class="op">)</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">mean_samples</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"samples per year on average"</span><span class="op">)</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"mean and sd in blue, median + 1rst and 3rd quartile represented by dashed lines,  percentile 90 in red"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">station_yearly_stats</span><span class="op">$</span><span class="va">year</span>, <span class="st">"\nn="</span>, <span class="va">station_yearly_stats</span><span class="op">$</span><span class="va">nb_analyses</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">p</span>  <span class="op">&lt;-</span></span>
<span>    <span class="va">p</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span></span>
<span>      trim <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      scale <span class="op">=</span> <span class="st">"width"</span>,</span>
<span>      adjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>      draw_quantiles <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>      fill <span class="op">=</span> <span class="st">"lightblue1"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> <span class="co"># draw the violin and adds an horizontal red line corresponding to the quantile 90</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span></span>
<span>      trim <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      scale <span class="op">=</span> <span class="st">"width"</span>,</span>
<span>      adjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      fill <span class="op">=</span> <span class="st">"transparent"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> <span class="co"># draw the same violin but with black lines and no fill</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span></span>
<span>      trim <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      scale <span class="op">=</span> <span class="st">"width"</span>,</span>
<span>      adjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>      draw_quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span>,</span>
<span>      linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>      fill <span class="op">=</span> <span class="st">"transparent"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> <span class="co"># adds the median, the 1st and 3rd quartiles in dashed line</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span></span>
<span>      fun.data <span class="op">=</span> <span class="va">mean_sdl</span>,</span>
<span>      fun.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>      geom <span class="op">=</span> <span class="st">"pointrange"</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"blue4"</span>,</span>
<span>      fill <span class="op">=</span> <span class="st">"transparent"</span></span>
<span>    <span class="op">)</span>  <span class="co"># adds the mean and the standard deviation in blue</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">valid_stations</span><span class="op">$</span><span class="va">code_station</span>, <span class="va">plot_nitrates</span><span class="op">)</span></span></code></pre></div>
<p><img src="data_extraction_naiades_files/figure-html/unnamed-chunk-19-1.png" width="90%" style="display: block; margin: auto;"><img src="data_extraction_naiades_files/figure-html/unnamed-chunk-19-2.png" width="90%" style="display: block; margin: auto;"><img src="data_extraction_naiades_files/figure-html/unnamed-chunk-19-3.png" width="90%" style="display: block; margin: auto;"><img src="data_extraction_naiades_files/figure-html/unnamed-chunk-19-4.png" width="90%" style="display: block; margin: auto;"><img src="data_extraction_naiades_files/figure-html/unnamed-chunk-19-5.png" width="90%" style="display: block; margin: auto;"><img src="data_extraction_naiades_files/figure-html/unnamed-chunk-19-6.png" width="90%" style="display: block; margin: auto;"><img src="data_extraction_naiades_files/figure-html/unnamed-chunk-19-7.png" width="90%" style="display: block; margin: auto;"><img src="data_extraction_naiades_files/figure-html/unnamed-chunk-19-8.png" width="90%" style="display: block; margin: auto;"><img src="data_extraction_naiades_files/figure-html/unnamed-chunk-19-9.png" width="90%" style="display: block; margin: auto;"><img src="data_extraction_naiades_files/figure-html/unnamed-chunk-19-10.png" width="90%" style="display: block; margin: auto;"><img src="data_extraction_naiades_files/figure-html/unnamed-chunk-19-11.png" width="90%" style="display: block; margin: auto;"><img src="data_extraction_naiades_files/figure-html/unnamed-chunk-19-12.png" width="90%" style="display: block; margin: auto;"><img src="data_extraction_naiades_files/figure-html/unnamed-chunk-19-13.png" width="90%" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Dorchies.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
