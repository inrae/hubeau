<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Performing queries on the 'Ecoulement' API • hubeau</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Performing queries on the 'Ecoulement' API">
<meta property="og:description" content="hubeau">
<meta property="og:image" content="https://inrae.github.io/hubeau/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hubeau</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example_ecoulement_api.html">Performing queries on the 'Ecoulement' API</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/inrae/hubeau" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example_ecoulement_api_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="example_ecoulement_api_files/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="example_ecoulement_api_files/leaflet-1.3.1/leaflet.js"></script><link href="example_ecoulement_api_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="example_ecoulement_api_files/proj4-2.6.2/proj4.min.js"></script><script src="example_ecoulement_api_files/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="example_ecoulement_api_files/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="example_ecoulement_api_files/leaflet-binding-2.1.2/leaflet.js"></script><script src="example_ecoulement_api_files/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="example_ecoulement_api_files/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script><link href="example_ecoulement_api_files/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="example_ecoulement_api_files/HomeButton-0.0.1/home-button.js"></script><script src="example_ecoulement_api_files/HomeButton-0.0.1/easy-button-src.min.js"></script><script src="example_ecoulement_api_files/clipboard-0.0.1/setClipboardText.js"></script><link href="example_ecoulement_api_files/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="example_ecoulement_api_files/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Performing queries on the ‘Ecoulement’ API</h1>
                        <h4 data-toc-skip class="author">Pascal Irz,
David Dorchies</h4>
            
            <h4 data-toc-skip class="date">2023-05-31</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/inrae/hubeau/blob/master/vignettes/example_ecoulement_api.Rmd" class="external-link"><code>vignettes/example_ecoulement_api.Rmd</code></a></small>
      <div class="hidden name"><code>example_ecoulement_api.Rmd</code></div>

    </div>

    
    
<p>This vignette shows how to use the <a href="https://github.com/inrae/hubeau" class="external-link"><code>hubeau</code> R package</a>
in order to retrieve data from the French streams drought monitoring
network (<a href="https://onde.eaufrance.fr/" class="external-link">Observatoire National Des
Etiage, ONDE</a>) from the <a href="https://hubeau.eaufrance.fr/page/api-ecoulement" class="external-link">API “Ecoulement
des cours d’eau”</a> of the <a href="https://hubeau.eaufrance.fr/" class="external-link">Hub’eau</a> portal.</p>
<p>Nationwide, this network encompasses 3000+ observation sites, that
are streams stretches selected to reflect the severity of drought
events, i.e. that flow in “normal” conditions but dry out in case of
drought. Located at the upstream of the river basins, these sites are
expected to act as ‘sentinels’ and to provide early warning of the
necessity of restricting water withdrawal in rivers and associated water
tables.</p>
<p>We illustrate the use of this API for the departement of
Ille-et-Vilaine (<code>code_departement=35</code>) with some example of
maps and charts useful for the interpretation of these data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_dept</span> <span class="op">&lt;-</span> <span class="st">"35"</span></span></code></pre></div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>First, we need to load the packages used in this vignette for
processing data and display results on charts and map:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inrae.github.io/hubeau/">hubeau</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>“Ecoulement” is one of the 10 APIs that can be queried with the
<a href="https://inrae.github.io/hubeau/">hubeau</a> R package. These APIs can be listed using the
<code><a href="../reference/lists.html">list_apis()</a></code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lists.html">list_apis</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "prelevements"         "indicateurs_services" "hydrometrie"         </span></span>
<span><span class="co">#&gt;  [4] "niveaux_nappes"       "poisson"              "ecoulement"          </span></span>
<span><span class="co">#&gt;  [7] "hydrobio"             "temperature"          "qualite_eau_potable" </span></span>
<span><span class="co">#&gt; [10] "qualite_nappes"</span></span></code></pre></div>
<p>The list of the API endpoints is provided by the function
<code>list_endpoints</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lists.html">list_endpoints</a></span><span class="op">(</span>api <span class="op">=</span> <span class="st">"ecoulement"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "stations"     "observations" "campagnes"</span></span></code></pre></div>
<ul>
<li>
<code>stations</code> lists the monitoring stations</li>
<li>
<code>campagnes</code> lists the surveys</li>
<li>
<code>observations</code> is the data itself, indicating if, at the
date of the survey, the river flows or if it is dry (which is assessed
visually in the field).</li>
</ul>
<p><code>station</code> and <code>observations</code> can be joined
<em>at least</em> by the field <code>code_station</code>.</p>
<p><code>observations</code> and <code>campagne</code> can be joined by
the field <code>code_campagne</code>.</p>
<p>For each endpoint, the function <code><a href="../reference/lists.html">list_params()</a></code> gives the
different parameters that can be retrieved.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lists.html">list_params</a></span><span class="op">(</span>api <span class="op">=</span> <span class="st">"ecoulement"</span>,</span>
<span>            endpoint <span class="op">=</span> <span class="st">"observations"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "format"               "code_station"         "libelle_station"     </span></span>
<span><span class="co">#&gt;  [4] "code_departement"     "libelle_departement"  "code_commune"        </span></span>
<span><span class="co">#&gt;  [7] "libelle_commune"      "code_region"          "libelle_region"      </span></span>
<span><span class="co">#&gt; [10] "code_bassin"          "libelle_bassin"       "code_cours_eau"      </span></span>
<span><span class="co">#&gt; [13] "libelle_cours_eau"    "code_campagne"        "code_reseau"         </span></span>
<span><span class="co">#&gt; [16] "libelle_reseau"       "date_observation_min" "date_observation_max"</span></span>
<span><span class="co">#&gt; [19] "code_ecoulement"      "libelle_ecoulement"   "longitude"           </span></span>
<span><span class="co">#&gt; [22] "latitude"             "distance"             "bbox"                </span></span>
<span><span class="co">#&gt; [25] "sort"                 "page"                 "size"                </span></span>
<span><span class="co">#&gt; [28] "fields"               "Accept"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="retrieving-the-data">Retrieving the data<a class="anchor" aria-label="anchor" href="#retrieving-the-data"></a>
</h2>
<div class="section level3">
<h3 id="sites">Sites<a class="anchor" aria-label="anchor" href="#sites"></a>
</h3>
<p>Retrieve the available fields.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">param_stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/lists.html">list_params</a></span><span class="op">(</span>api <span class="op">=</span> <span class="st">"ecoulement"</span>, endpoint <span class="op">=</span> <span class="st">"stations"</span><span class="op">)</span>,</span>
<span>    collapse <span class="op">=</span> <span class="st">","</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Download the data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ecoulement.html">get_ecoulement_stations</a></span><span class="op">(</span></span>
<span>  code_departement <span class="op">=</span> <span class="va">my_dept</span>,</span>
<span>  fields <span class="op">=</span> <span class="va">param_stations</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>stations</code> dataframe is transformed into a
<code>sf</code> geographical object, then mapped.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stations_geo</span> <span class="op">&lt;-</span> <span class="va">stations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">code_station</span>,</span>
<span>         <span class="va">libelle_station</span>,</span>
<span>         <span class="va">longitude</span>,</span>
<span>         <span class="va">latitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mapview</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span></span>
<span>  <span class="va">stations_geo</span>,</span>
<span>  popup <span class="op">=</span> <span class="fu">leafpop</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/leafpop/man/popup.html" class="external-link">popupTable</a></span><span class="op">(</span></span>
<span>    <span class="va">stations_geo</span>,</span>
<span>    zcol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"code_station"</span>, <span class="st">"libelle_station"</span><span class="op">)</span>,</span>
<span>    feature.id <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    row.numbers <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"libelle_station"</span>, </span>
<span>  legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-689bdeefe3e5f69d6078" style="width:70%;height:355.968px;"></div>
<script type="application/json" data-for="htmlwidget-689bdeefe3e5f69d6078">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[48.441498509,48.265674182,48.383815733,48.464464429,48.502846021,48.531047534,48.446522767,48.506565302,48.38821811,48.118585251,48.174043666,48.198424119,48.177119885,48.189361194,48.239454793,48.134509298,48.119798464,48.059526181,48.14588703,48.151071556,47.970742148,48.009026904,47.921624205,47.974470843,47.808237799,47.876689877,47.839508754,47.741558267,47.772594268,47.925848752,47.923792732],[-1.172377777,-1.239439959,-1.597573178,-1.32914381,-1.598131066,-1.709549094,-1.76981295,-1.854030333,-1.842303173,-1.081219499,-1.217900066,-1.154677126,-1.356266295,-1.605829163,-1.787941759,-2.239634027,-2.036268543,-1.910569694,-1.8576347,-1.820913283,-1.139956049,-1.279196997,-1.723698006,-2.044142713,-1.24658966,-1.480812607,-1.833684413,-1.855026652,-1.62221073,-2.069211718,-1.981805226],6,null,"stations_geo",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6},null,null,["<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J0014011&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Les Chevaux Morts&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J0030001&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Le Guérabouin&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J0130001&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Le Val&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J0201511&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>La Boulaie&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J0210001&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>La Chênelais&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J0323011&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>La Corbonnais&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J0407611&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Le trémigon&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J0407612&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Le Meuleuc&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J0700001&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>LE LINON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7024041&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Le rouillon&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7043011&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>La Brisetière&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7054011&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>LA PEROUSE&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7070001&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>La Fontaine De La Cibonnière&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7114011&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Le Caleuvre&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7214011&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Le Vignoc&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7300002&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Le Grenedan&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7330001&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Le boutavent&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7364221&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Le Rohuel&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7373110&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>La Vaunoise&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7380001&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>La Cotardière&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7410001&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>la seiche&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7430001&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Le vergéal&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7500611&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>La chalouzais&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7513011&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Le Canut Nord&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7600001&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Le Semnon&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7620001&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Les Gadouilles&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7700611&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Le Tréfineu&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7720001&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>Ruisseau de Port de Roche&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J7824011&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td> La Planche Cleuze&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J8610001&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td> La Bertais&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class= id='popup'><tr><td><\/td><th>code_station&emsp;<\/th><td>J8640001&emsp;<\/td><\/tr><tr><td><\/td><th>libelle_station&emsp;<\/th><td>le combs&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["Les Chevaux Morts","Le Guérabouin","Le Val","La Boulaie","La Chênelais","La Corbonnais","Le trémigon","Le Meuleuc","LE LINON","Le rouillon","La Brisetière","LA PEROUSE","La Fontaine De La Cibonnière","Le Caleuvre","Le Vignoc","Le Grenedan","Le boutavent","Le Rohuel","La Vaunoise","La Cotardière","la seiche","Le vergéal","La chalouzais","Le Canut Nord","Le Semnon","Les Gadouilles","Le Tréfineu","Ruisseau de Port de Roche"," La Planche Cleuze"," La Bertais","le combs"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-2.239634027,47.741558267,-1.081219499,48.531047534,true,"stations_geo","Zoom to stations_geo","<strong> stations_geo <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"stations_geo",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"limits":{"lat":[47.741558267,48.531047534],"lng":[-2.239634027,-1.081219499]},"fitBounds":[47.741558267,-2.239634027,48.531047534,-1.081219499,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
<div class="section level3">
<h3 id="surveys">Surveys<a class="anchor" aria-label="anchor" href="#surveys"></a>
</h3>
<p>A survey encompasses a series of visual observations carried out on
stations at the “departement” grain. It is tagged as “usuelle” if it is
a routine (i.e. around the 24th of the month from May to September), as
“complémentaire” if not (e.g. during very dry periods).</p>
<p>Download the <code>surveys</code> dataframe.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ecoulement.html">get_ecoulement_campagnes</a></span><span class="op">(</span></span>
<span>  code_departement <span class="op">=</span> <span class="va">my_dept</span>, <span class="co"># department id</span></span>
<span>  date_campagne_min <span class="op">=</span> <span class="st">"2012-01-01"</span> <span class="co"># start date</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">&lt;-</span> <span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>code_campagne <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">code_campagne</span><span class="op">)</span>, </span>
<span>         year <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date_campagne</span><span class="op">)</span>,</span>
<span>         month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">date_campagne</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">code_campagne</span>,</span>
<span>           <span class="va">year</span>, </span>
<span>           <span class="va">month</span>,</span>
<span>           <span class="va">libelle_type_campagne</span><span class="op">)</span></span></code></pre></div>
<p>Visualise a few rows.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">code_campagne</th>
<th align="right">year</th>
<th align="right">month</th>
<th align="left">libelle_type_campagne</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">96911</td>
<td align="right">2022</td>
<td align="right">10</td>
<td align="left">complémentaire</td>
</tr>
<tr class="even">
<td align="left">96868</td>
<td align="right">2022</td>
<td align="right">10</td>
<td align="left">complémentaire</td>
</tr>
<tr class="odd">
<td align="left">96831</td>
<td align="right">2022</td>
<td align="right">9</td>
<td align="left">usuelle</td>
</tr>
<tr class="even">
<td align="left">96724</td>
<td align="right">2022</td>
<td align="right">9</td>
<td align="left">complémentaire</td>
</tr>
<tr class="odd">
<td align="left">96652</td>
<td align="right">2022</td>
<td align="right">8</td>
<td align="left">usuelle</td>
</tr>
<tr class="even">
<td align="left">96562</td>
<td align="right">2022</td>
<td align="right">8</td>
<td align="left">complémentaire</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="observations">Observations<a class="anchor" aria-label="anchor" href="#observations"></a>
</h3>
<p>Retrieve the available fields.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">param_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/lists.html">list_params</a></span><span class="op">(</span>api <span class="op">=</span> <span class="st">"ecoulement"</span>, endpoint <span class="op">=</span> <span class="st">"observations"</span><span class="op">)</span>,</span>
<span>    collapse <span class="op">=</span> <span class="st">","</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Download the data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">observations</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/get_ecoulement.html">get_ecoulement_observations</a></span><span class="op">(</span></span>
<span>    code_departement <span class="op">=</span> <span class="va">my_dept</span>,</span>
<span>    date_observation_min <span class="op">=</span> <span class="st">"2012-01-01"</span>,</span>
<span>    fields <span class="op">=</span> <span class="va">param_obs</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">observations</span> <span class="op">&lt;-</span> <span class="va">observations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">code_ecoulement</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>code_campagne <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">code_campagne</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="graphical-output-of-monthly-indicator">Graphical output of monthly indicator<a class="anchor" aria-label="anchor" href="#graphical-output-of-monthly-indicator"></a>
</h2>
<p>We first need to join survey and observation data:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_and_surv</span> <span class="op">&lt;-</span> <span class="va">observations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">surveys</span>, by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">code_campagne</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">code_station</span>, <span class="va">libelle_station</span>, <span class="va">year</span>, <span class="va">month</span>, <span class="va">code_ecoulement</span><span class="op">)</span></span></code></pre></div>
<p>And, in case of several observations during the same month, we keep
the driest status:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_and_surv</span> <span class="op">&lt;-</span> <span class="va">obs_and_surv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">code_ecoulement</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">code_station</span>, <span class="va">libelle_station</span>, <span class="va">year</span>, <span class="va">month</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>code_ecoulement <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">last</a></span><span class="op">(</span><span class="va">code_ecoulement</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">'drop'</span><span class="op">)</span></span></code></pre></div>
<p>The flow observations codes are translated in English:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flow_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"1"</span>  <span class="op">=</span> <span class="st">"Visible flow"</span>,</span>
<span>  <span class="st">"1a"</span> <span class="op">=</span> <span class="st">"Decent visible flow"</span>,</span>
<span>  <span class="st">"1f"</span> <span class="op">=</span> <span class="st">"Weak visible flow"</span>,</span>
<span>  <span class="st">"2"</span>  <span class="op">=</span> <span class="st">"No visible flow"</span>,</span>
<span>  <span class="st">"3"</span>  <span class="op">=</span> <span class="st">"Dry"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">obs_and_surv</span><span class="op">$</span><span class="va">flow_label</span> <span class="op">&lt;-</span> <span class="va">flow_labels</span><span class="op">[</span><span class="va">obs_and_surv</span><span class="op">$</span><span class="va">code_ecoulement</span><span class="op">]</span></span></code></pre></div>
<p>Custom plot function.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_stream_flow</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">sel_station</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co"># selected data</span></span>
<span>    <span class="va">sel_data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">code_station</span> <span class="op">==</span> <span class="va">sel_station</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>flow_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">flow_label</span>, levels <span class="op">=</span> <span class="va">flow_labels</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># station name for plot title</span></span>
<span>    <span class="va">station_lab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sel_data</span><span class="op">$</span><span class="va">libelle_station</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># year range</span></span>
<span>    <span class="va">year_range</span> <span class="op">&lt;-</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">sel_data</span><span class="op">$</span><span class="va">year</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sel_data</span><span class="op">$</span><span class="va">year</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># plot</span></span>
<span>    <span class="va">sel_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">month</span>,</span>
<span>                 y <span class="op">=</span> <span class="va">year</span>,</span>
<span>                 color <span class="op">=</span> <span class="va">flow_label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">15</span>, size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Flow status"</span>,</span>
<span>                         values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, </span>
<span>                                    <span class="st">"deepskyblue"</span>, </span>
<span>                                    <span class="st">"lightblue"</span>, </span>
<span>                                    <span class="st">"orange"</span>, </span>
<span>                                    <span class="st">"red"</span><span class="op">)</span>, </span>
<span>                         labels <span class="op">=</span> <span class="va">flow_labels</span>, </span>
<span>                         drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,</span>
<span>                         labels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,</span>
<span>                         limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">year_range</span>,</span>
<span>                         labels <span class="op">=</span> <span class="va">year_range</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Months"</span>,</span>
<span>           y <span class="op">=</span> <span class="st">"Years"</span>,</span>
<span>           title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s (%s)"</span>, <span class="va">station_lab</span>, <span class="va">sel_station</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>        axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span>,</span>
<span>        plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                          colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>        panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span></span></code></pre></div>
<p>Display plot for all stations that contain at least one observation
with “Dry” status.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dry_stations</span> <span class="op">&lt;-</span> <span class="va">obs_and_surv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">code_ecoulement</span> <span class="op">==</span> <span class="st">"3"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">code_station</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">unique</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">dry_stations</span>, <span class="va">gg_stream_flow</span>, data <span class="op">=</span> <span class="va">obs_and_surv</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-1.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-2.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-3.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-4.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-5.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-6.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-7.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-8.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-9.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-10.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-11.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-12.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-13.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-14.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-15.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-16.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-17.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-18.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-19.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-20.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-21.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-22.png" width="70%" style="display: block; margin: auto;"><img src="example_ecoulement_api_files/figure-html/unnamed-chunk-19-23.png" width="70%" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Dorchies.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
